;S65v58
;Эльфлоадер
;ELFloader
;(c) Rst7/CBSIE, BoBa
;(p) Kamikadze!
;Version: 2.0
;PatchID: 7097
;Details: https://patches.kibab.com/patches/details.php5?id=7097
;!к патчу прикреплён файл, https://patches.kibab.com/cnt.php5?d=s65v58&f=elfloader_v2_0.zip

/*
+Загрузка всех .elf-файлов из каталога 0:\ZBin\Daemons

+Загрузка необходимых .elf файлов при выборе файла с произвольным расширением
 Обрабатывается при помощи ExtD.elf - необходим в каталоге 0:\ZBin\Daemons
 по файлу 0:\ZBin\etc\extension.cfg. Формат файла:
 >>>>---
 ;Это комментарий, он начинается с символа ;
 
 ;Универсальные для тех, у кого не указано какое-либо поле
 
 RUN=0:\ZBin\TED\TED.elf
 SMALL=0:\ZBin\img\UNK_SMALL.png
 BIG=0:\ZBin\img\UNK_LARGE.png
 ALTRUN=0:\ZBin\TED\TED.elf
 
 ;первый, расширение txt очень желательно указывать, т.к. по нему открываются неизвестные файлы
 [txt]
 SMALL=0:\ZBin\img\TXT_SMALL.png
 BIG=0:\ZBin\img\TXT_LARGE.png
 
 ;второй
 [bcfg]
 RUN=0:\ZBin\utilities\CfgEdit.elf
 SMALL=0:\ZBin\img\BCFG_SMALL.png
 BIG=0:\ZBin\img\BCFG_LARGE.png
 
 ; и т.д.
 
 ; если поле не указано, то оно берется из первых
 ---<<<<<

+Расширение таблицы регистрации расширений файлов

+Очередной перенос HELPER_PROC на cepid=440A для более корректной работы
 с жабой

+Расширение PIT при помощи .png файлов
 Обрабатываются файлы из каталога 0:\ZBin\img\ с именами %d.png
 для замены штатных картинок или из эльфов - указатель на строку
 с именем файла вместо ID (аналогично ESI)
Заменяем все старые эльфы на приложенные из архива
*/

;FSWI_PATCH1
0x000927C0: 1A0000EA DCF09FE5
;FSWI_PATCH3,FSWI_PATCH2
0x000928A3: A100000000 000480FDA0
;PATCH_EXT2_R2R3
0x0093BBA0: B4369FE50010A0E3A8269FE5 00C09FE53CFF2FE14881FDA0
;PATCH_EXT2_R8R10
0x0093BD94: 0050A0E3B8849FE5B8A49FE5 00C09FE53CFF2FE16481FDA0
;PATCH_EXT2_IMPL
0x0093C3D8: 84A11FE51CE09DE5 1CE09DE50F402DE9
0x0093C3E0: 00C09AE53C005CE3F085BDA80080A0E3 04E08FE204F01FE5A086FDA00080A0E3
0x0093C3F0: A0711FE58C8287E78C7287E0 008080E50070A0E10F40BDE8
;PATCH_EXT2_IMPL_2
0x0093C418: 01008CE200008AE5 0000A0E10000A0E1
;PATCH_PROPERTY_WINDOW
0x00981D50: 0370A0E10260A0E10150A0E1 04E08FE204F01FE53481FDA0
;PATCH_NO_BROWSE_TXT
0x00BB9280: 211C 16E0
;SWILIB_FUNC171,SWILIB_FUNC172
#pragma enable old_equal_ff
0x00FD45C4: C091FDA09C91FDA0
;SWILIB_FUNC19C
0x00FD4670: E991FDA0
;SWILIB_FUNC1B8_1BB
0x00FD46E0: C09168A8C49168A8BC9168A8C89168A8
;FSWI_CODE
0x00FD8000: 1EFF2FE100109DE5200011E3122F8F02
0x00FD8010: 0400000AC70050E3B200DE0014E08D05
0x00FD8020: 01E08EE235208FE234109FE5803CC0E3
0x00FD8030: 400D53E30500008A800C10E300402D09
0x00FD8040: 0040FD0803C191E704C08D1514208D05
0x00FD8050: 0100BDE800F069E10F80FDE81CFF2FE1
0x00FD8060: 604700000040FDA0
;CODE,DATA_C
0x00FD8100: 11FF2FE1203EA0E10A0053E30100001A
0x00FD8110: 390100EB1080BDE8E83E9FE50140A0E1
0x00FD8120: 0210A0E104209FE5020050E113FF2FE1
0x00FD8130: 102700000E402DE9F8209DE5A00452E3
0x00FD8140: 6D01003BE080BDE804E08EE201402DE9
0x00FD8150: 470100EB0030A0E1042080E20010A0E3
0x00FD8160: 0180BDE804E08EE20F402DE9400100EB
0x00FD8170: 00A0A0E1048080E20050A0E30F80BDE8
0x00FD8180: 04E02DE500200FE1000000EF00100FE1
0x00FD8190: C01081E301F021E10000A0E10000A0E1
0x00FD81A0: 0000A0E17AFF17EE0000A0E10000A0E1
0x00FD81B0: 0000A0E1FAFFFF1A0000A0E39A0F07EE
0x00FD81C0: 0000A0E10000A0E10000A0E10000A0E1
0x00FD81D0: 150F07EE0000A0E10000A0E10000A0E1
0x00FD81E0: 0000A0E102F021E104F09DE400402DE9
0x00FD81F0: 1D0100EF0080BDE87FB5FFB00025ED43
0x00FD8200: 0595642166A8FFF7F2EF7F9800246B46
0x00FD8210: 802211020ADF0190002801D528003EE1
0x00FD8220: 6B46342209A90BDF342805D001986946
0x00FD8230: 0DDF0120C04332E109989A49884204D0
0x00FD8240: 019869460DDF0220F4E709A8808D0B28
0x00FD8250: 02D30820C04322E1049416AD083511E0
0x00FD8260: 306801280AD128680599884200D20590
0x00FD8270: E9684018844201D22868441804982035
0x00FD8280: 401C0490049809A9898D884227DA08A8
0x00FD8290: 01B4119805990AAE768D01AB00227143
0x00FD82A0: 411802980FDF1199059A0AAB5B8D01B0
0x00FD82B0: 5A438918884204D0019869460DDF0320
0x00FD82C0: B8E701982E00083E6B46202231000BDF
0x00FD82D0: 2028C5D0019869460DDF0420BAE70598
0x00FD82E0: 251A280014DF040004D1019869460DDF
0x00FD82F0: 0D209FE72900FFF77AEF0020049016A8
0x00FD8300: 083053E02868012802D0022817D0B0E0
0x00FD8310: 02988268002A44D0006805996B46401A
0x00FD8320: 211801980BDF02998968884239D00198
0x00FD8330: 69460DDF200015DF0A20C043AFE00298
0x00FD8340: 806814DF0390002806D1019869460DDF
0x00FD8350: 200015DF06206DE70298039982680198
0x00FD8360: 6B460BDF02998968884208D001986946
0x00FD8370: 0DDF039815DF200015DF07206AE70398
0x00FD8380: 66AA05E0192902DA4368890053500830
0x00FD8390: 01680029F6D17899002000292ED10398
0x00FD83A0: 15DF0498401C04900298203002900598
0x00FD83B0: 41420791049809A9898D884260DA029D
0x00FD83C0: 684601B4083D696801AB029800220FDF
0x00FD83D0: 696801B0884295D0019869460DDF2000
0x00FD83E0: 15DF052026E7039DEB189A18059B5218
0x00FD83F0: 116862581219D21A6250401C789AC100
0x00FD8400: 9142CCD20299779B0968039D4A42C100
0x00FD8410: AD186D18ED186D682D062D0E0695FF2D
0x00FD8420: EBD0FD2DDFD0079D069E6519002EE4D0
0x00FD8430: 022E02D0172E09D012E0039EF3189A18
0x00FD8440: 521811686A5812196A50D6E7039EF318
0x00FD8450: 9A18059B521811686A581219D21AF3E7
0x00FD8460: 019869460DDF200015DF039815DF0C20
0x00FD8470: 63E7019869460DDF200015DF0B20D9E6
0x00FD8480: 019869460DDF00F061F9079D0F9E829B
0x00FD8490: 819A80997F98A4196419A04700207FB0
0x00FD84A0: 04B070BD7F454C4610B5A0B069461400
0x00FD84B0: 7E22A3DF0023002221006846FFF79CFE
0x00FD84C0: 002801D0002000E0012020B010BD0000
0x00FD84D0: 10402DE90040A0E10700A0E3440C80E3
0x00FD84E0: 540100EF0C009FE5001090E50400A0E1
0x00FD84F0: 1040BDE801FFFFEA0090FDA010402DE9
0x00FD8500: AFDF4DE26F0F8DE20140A0E11A0000EF
0x00FD8510: 70109FE56F0F8DE2170000EF0D20A0E1
0x00FD8520: 6F1F8DE204008DE26B0000EF000050E3
0x00FD8530: 0F00000A0410A0E16F0F8DE21A0000EF
0x00FD8540: AD108DE26F0F8DE2170000EF0030A0E3
0x00FD8550: 0020A0E30210A0E16F0F8DE225FFFFFA
0x00FD8560: 0D10A0E104008DE26C0000EF000050E3
0x00FD8570: EFFFFF1A0D10A0E104008DE26D0000EF
0x00FD8580: AFDF8DE21080BDE85487FDA030402DE9
0x00FD8590: 30509FE50040A0E1F20200EB140085E2
0x00FD85A0: 8C0000EF20009FE50520A0E10010A0E3
0x00FD85B0: 710100EF14009FE5001090E50400A0E1
0x00FD85C0: 3040BDE8CDFEFFEA5C87FDA0FC84FDA0
0x00FD85D0: 0490FDA000B580280BDB064908188038
0x00FD85E0: 0078802805DB044AFF21C94340001018
0x00FD85F0: 405A00BDD487FDA05488FDA030402DE9
0x00FD8600: 0040A0E10150A0E10010A0E30500A0E1
0x00FD8610: 260100EF030000EAEDFFFFFA0010A0E1
0x00FD8620: 0500A0E11C0000EF0100D4E4000050E3
0x00FD8630: F8FFFF1A3080BDE830402DE90040A0E1
0x00FD8640: 0F00A0E3250100EF0050A0E1071F8FE2
0x00FD8650: 240100EF0020A0E30510A0E10400A0E1
0x00FD8660: 940000EF0500A0E1290100EF3080BDE8
0x00FD8670: 7478740010402DE978409FE5000094E5
0x00FD8680: 000050E31080BD180400A0E3140000EF
0x00FD8690: 0010A0E3001080E5000084E51080BDE8
0x00FD86A0: F0402DE9460100EFF1FFFFEB0040A0E1
0x00FD86B0: 005094E58562A0E1240086E2140000EF
0x00FD86C0: 0070A0E1042086E20410A0E11E0100EF
0x00FD86D0: 010085E2000087E50400A0E1150000EF
0x00FD86E0: 10009FE5007080E5470100EF850287E0
0x00FD86F0: 040080E2F080BDE8C09168A870402DE9
0x00FD8700: 0040A0E10150A0E1FF00A0E3250100EF
0x00FD8710: 0060A0E10410A0E11F0100EF5C10A0E3
0x00FD8720: 0600A0E11C0000EF0510A0E10600A0E1
0x00FD8730: 210100EF0600A0E1BEFFFFEB0600A0E1
0x00FD8740: 290100EF0000A0E37080BDE8004B1847
0x00FD8750: 8081FDA02A2E656C66000000303A5C5A
0x00FD8760: 42696E5C4461656D6F6E735C00000000
0x00FD8770: C087FDA055000000FF077805C487FDA0
0x00FD8780: CC87FDA0A984FDA000000000303A5C5A
0x00FD8790: 42696E5C696D675C656C665F736D616C
0x00FD87A0: 6C2E706E67000000303A5C5A42696E5C
0x00FD87B0: 696D675C656C665F6269672E706E6700
0x00FD87C0: 656C66008C87FDA000000000A887FDA0
0x00FD87D0: 000000005F5F275F223AC5D85F255F3C
0x00FD87E0: 5F5F5F5F5F27272222072D2D5F545F3E
0x00FD87F0: 5F5F5F5FFFF6F75FFD83B315F063F23C
0x00FD8800: BF2D52F4F82B4969A3E714FAF1FCF33E
0x00FD8810: 5F5F5FF5808182838485868788898A8B
0x00FD8820: 8C8D8E8F909192939495969798999A9B
0x00FD8830: 9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAAB
0x00FD8840: ACADAEAFE0E1E2E3E4E5E6E7E8E9EAEB
0x00FD8850: ECEDEEEF100411041204130414041504
0x00FD8860: 16041704180419041A041B041C041D04
0x00FD8870: 1E041F04200421042204230424042504
0x00FD8880: 26042704280429042A042B042C042D04
0x00FD8890: 2E042F04300431043204330434043504
0x00FD88A0: 36043704380439043A043B043C043D04
0x00FD88B0: 3E043F042D002D002D00A6002B00A600
0x00FD88C0: A600AC00AC00A600A600AC002D002D00
0x00FD88D0: 2D00AC004C002B0054002B002D002B00
0x00FD88E0: A600A6004C003304A6005400A6003D00
0x00FD88F0: 2B00A600A600540054004C004C002D00
0x00FD8900: 33042B002B002D002D002D002D00A600
0x00FD8910: A6002D00400441044204430444044504
0x00FD8920: 46044704480449044A044B044C044D04
0x00FD8930: 4E044F04010451040404540407045704
0x00FD8940: 0E045E04B0002220B70076001621A400
0x00FD8950: A600A000312E322E35000000303A5C5A
0x00FD8960: 42696E5C696D675C000000002E706E67
0x00FD8970: 00000000
;RET_ADRS
0x00FD9000: 637969A1BB7769A1A15E40A1B39915A1
0x00FD9010: C99915A1
;HELPER_PROC,HELPER_PROC_DATA
0x00FD9100: 00402DE910D04DE20D00A0E1530100EF
0x00FD9110: 000050E31100000AF230DDE104009DE5
0x00FD9120: 010053E30600001A08209DE5000052E3
0x00FD9130: 0A00000A0C109DE532FF2FE110D08DE2
0x00FD9140: 0080BDE801002DE9F420DDE1FC1FA0E3
0x00FD9150: 0900A0E3420C80E3000100EF04D08DE2
0x00FD9160: 10D08DE20080BDE800402DE920209FE5
0x00FD9170: 20109FE50000A0E301002DE98030A0E3
0x00FD9180: 0700A0E3440C80E3050100EF04D08DE2
0x00FD9190: 0080BDE80091FDA0F491FDA000402DE9
0x00FD91A0: 460100EF410100EF9010A0E30900A0E3
0x00FD91B0: 420C80E3000100EF470100EF0080BDE8
0x00FD91C0: 00402DE904002DE90030A0E10700A0E3
0x00FD91D0: 440C80E30120A0E10110A0E3000100EF
0x00FD91E0: 04D08DE20080BDE810B5140088472000
0x00FD91F0: 15DF10BD48454C5045520000
;PIT_PNG_EXTENSION
0x00FD9500: 10402DE90040A0E11C0100EB000050E3
0x00FD9510: 1080BD180400A0E114C51FE53CFF2FE1
0x00FD9520: 040050E11CC51FE51CFF2FE100B50800
0x00FD9530: 14DF00BD00B5080015DF00BD30402DE9
0x00FD9540: 04D04DE20140A0E10250A0E15E0100EF
0x00FD9550: 000090E50D30A0E10520A0E10410A0E1
0x00FD9560: 0B0000EF04D08DE23080BDE8F0412DE9
0x00FD9570: 28D04DE20040A0E300408DE504408DE5
0x00FD9580: 0C308DE28020A0E3801CA0E30A0000EF
0x00FD9590: 08008DE5010070E33300000A0C00A0E3
0x00FD95A0: 140000EF0050A0E1004085E5044085E5
0x00FD95B0: 084085E508009DE50C308DE20820A0E3
0x00FD95C0: 20108DE20B0000EF080050E31B00001A
0x00FD95D0: 0810A0E320008DE2B20100EF000050E3
0x00FD95E0: 1600000AC0029FE501002DE9BC029FE5
0x00FD95F0: 01002DE90000A0E301002DE90030A0E1
0x00FD9600: 0020A0E10010A0E1A4029FE5A80100EF
0x00FD9610: 0C008DE5000050E30CD08DE20700000A
0x00FD9620: 560100EF04008DE5000050E31100001A
0x00FD9630: 0020A0E30210A0E10D00A0E1570100EF
0x00FD9640: 000095E5150000EF040095E5150000EF
0x00FD9650: 080095E5150000EF0500A0E1150000EF
0x00FD9660: 08009DE50C108DE20D0000EF0000A0E3
0x00FD9670: 28D08DE2F081BDE800009DE5620100EF
0x00FD9680: 000050E30020A01304108D12E9FFFF1A
0x00FD9690: 20229FE500009DE508108DE2A90100EF
0x00FD96A0: 00009DE50810A0E3580100EF04109DE5
0x00FD96B0: 00009DE5590100EF0000A0E301002DE9
0x00FD96C0: 01002DE901002DE924008DE201002DE9
0x00FD96D0: 2C008DE201002DE918109DE528308DE2
0x00FD96E0: 14009DE524208DE25A0100EF30009DE5
0x00FD96F0: 14D08DE2100050E30100001A00009DE5
0x00FD9700: AF0100EF1C009DE5080050E3010000AA
0x00FD9710: 00009DE5B00100EF18009DE5030050E3
0x00FD9720: 0100001A00009DE5AB0100EF18009DE5
0x00FD9730: 000050E3040050130100001A00009DE5
0x00FD9740: B10100EF00009DE504109DE51020A0E3
0x00FD9750: AC0100EF000050E30100000A00009DE5
0x00FD9760: AD0100EF00009DE50120A0E3FF10A0E3
0x00FD9770: AE0100EF04109DE500009DE50080A0E3
0x00FD9780: AA0100EF00009DE504109DE55F0100EF
0x00FD9790: 140000EF000085E50800A0E3140000EF
0x00FD97A0: 0060A0E1086085E510009DE514109DE5
0x00FD97B0: 910000E0140000EF040085E50070A0E1
0x00FD97C0: 000000EA018088E214009DE5000058E1
0x00FD97D0: 1900002A001095E500009DE50020A0E3
0x00FD97E0: 600100EF0400A0E11CC0A0E3080000EA
0x00FD97F0: 0020D1E50130D1E50210D1E5E02002E2
0x00FD9800: A3310CE0022083E1211382E10110C7E4
0x00FD9810: 010080E210109DE5010050E1E8FFFF2A
0x00FD9820: 001095E5001181E00320D1E5000052E3
0x00FD9830: EEFFFF1AC010A0E3F3FFFFEA080095E5
0x00FD9840: 0510A0E3B210C0E110109DE50010C0E5
0x00FD9850: 080095E514109DE50110C0E5080095E5
0x00FD9860: 041095E5041080E504109DE500009DE5
0x00FD9870: 5D0100EF0020A0E304108DE20D00A0E1
0x00FD9880: 570100EF000095E5150000EF0500A0E1
0x00FD9890: 150000EF08009DE50C108DE20D0000EF
0x00FD98A0: 0600A0E128D08DE2F081BDE83595FDA0
0x00FD98B0: 2D95FDA05489FDA03C95FDA000B507E0
0x00FD98C0: 412A02DB5B2A00DA2032491C0270401C
0x00FD98D0: 0A78002AF4D10021017000BD3030A0E3
0x00FD98E0: 010000EA010040E0013083E2010050E1
0x00FD98F0: FBFFFF2A0030C2E51EFF2FE110402DE9
0x00FD9900: 0040A0E10100A0E10A0050E31600003A
0x00FD9910: 640050E31000003AFA0F50E30A00003A
0x00FD9920: 1010A0E39C1D81E3010050E10200003A
0x00FD9930: 0420A0E1E8FFFFEB014084E20420A0E1
0x00FD9940: FA1FA0E3E4FFFFEB014084E20420A0E1
0x00FD9950: 6410A0E3E0FFFFEB014084E20420A0E1
0x00FD9960: 0A10A0E3DCFFFFEB014084E2300080E2
0x00FD9970: 0000C4E50000A0E30100C4E51080BDE8
0x00FD9980: F0432DE940DF4DE20040A0E1240EA0E1
0x00FD9990: 0A0050E30300001A0410A0E10D00A0E1
0x00FD99A0: C5FFFFFA080000EA50519FE50D00A0E1
0x00FD99B0: 0510A0E1C0FFFFFA0410A0E1CEFFFFEB
0x00FD99C0: 101085E20D00A0E1170000EF30519FE5
0x00FD99D0: 460100EF0560A0E10070A0E30080A0E3
0x00FD99E0: 000000EA0680A0E1006096E5000056E3
0x00FD99F0: 0E00000A040096E50D10A0E1190000EF
0x00FD9A00: 000050E3F6FFFF1A000058E30400000A
0x00FD9A10: 000096E5000088E5000095E5000086E5
0x00FD9A20: 006085E5470100EF080096E51A0000EA
0x00FD9A30: 470100EF0D00A0E1CBFEFFEB0060A0E1
0x00FD9A40: 0C00A0E3140000EF0040A0E10D00A0E1
0x00FD9A50: 1B0000EF010080E2140000EF040084E5
0x00FD9A60: 0D10A0E11A0000EF086084E5460100EF
0x00FD9A70: 000095E50090A0E3000084E5004085E5
0x00FD9A80: 0560A0E10680A0E1006096E5000056E3
0x00FD9A90: 0300001A470100EF080094E540DF8DE2
0x00FD9AA0: F083BDE8019089E2330059E3F4FFFF3A
0x00FD9AB0: 007088E5470100EF080096E5000050E3
0x00FD9AC0: 0300000A040090E5150000EF080096E5
0x00FD9AD0: 150000EF040096E50680A0E1150000EF
0x00FD9AE0: 006096E50800A0E1150000EF000056E3
0x00FD9AF0: F0FFFF1A080094E540DF8DE2F083BDE8
0x00FD9B00: 5C89FDA0C49168A8
;PATCH_GET_PIT,PATCH_GET_PITJ
#pragma disable old_equal_ff
0x011599C0: 10B5041CFFF7F5FF 004908470095FDA0
;PATCH_ESI
0x01405E98: 0C1C111C0E4A9042 004B18470481FDA0
;PATCH_ONCREATE,PATCH_ONCLOSE
0x016B7868: BB7769A1637969A1 8C85FDA0D084FDA0

;FREAD32,FWRITE32
#pragma enable old_equal_ff
;FREAD
0x00FD9400: FBB51500002403E00199AD1B08180190
0x00FD9410: 002D0FD00948854201DB461E00E02E00
0x00FD9420: 0098074F029B01993F683200B8472418
0x00FD9430: B042E9D0200003B0F0BDC04601400000
0x00FD9440: F094FDA0
;FWRITE
0x00FD9450: FBB51500002403E00199AD1B08180190
0x00FD9460: 002D0FD00948854201DB461E00E02E00
0x00FD9470: 0098074F029B01993F683200B8472418
0x00FD9480: B042E9D0200003B0F0BDC04601400000
0x00FD9490: F494FDA0
;RET_ADRS
0x00FD94F0: 0xA122ECF0,0xA122EDD8 ; fread fwrite
#pragma disable old_equal_ff

;------------------------- end -------------------------

