;S65v58
;Поддержка MMC/SD/SDHC 4GB карт
;MMC/SD/SDHC 4GB card support
;(c) DebriZ, Evgr
;Version: 4
;PatchID: 10642
;Details: https://patches.kibab.com/patches/details.php5?id=10642
/*
Добавлена поддержка всех мультимедийных карт MMC, SD и SDHC любого объема
Добавлено отображение объёма карт в GB
*/

; Change file/disk size output format (" 0.00"). 
0094E740: 0720A0E3 0820A0E3 
0094E7C6: 302E30300000 20302E303000

;MMC/SD/SDHC 4GB card support 
; Recalc card size using largest block size 
012569F0: 0C209DE5000052E3 2230DDE5A220A0E1 
012569F8: 30209D1500005213 013083E22230CDE5 
01256A00: 0000001A5C1080E5 F6FFFFEA5C1080E5 
01256A08: 2220DDE5BC31DDE1 4720D0E5010052E3 
01256A10: 022082E21122A0E1 0100001AAB0100EB 
01256A18: 013083E2930202E0 000000EAAE0100EB 

; Read/write support for SDHC 
;012575B0: 0040A0130C00001A 1000001A583095E5000053E30D00000A ;?! разности в прошивках S65 и CX75 
012575B8: 8004A0E1 B8FEFFEB 
012579B0: 8004A0E1 BAFDFFEB 
012A32F4: 8614A0E1 6DCFFEEB 
012A3590: 8614A0E1 C6CEFEEB 

; Increase MMC/SD/SDHC initialization timeout
1256B7C: 320051E3 C80051E3
1257610: 320050E3 C80050E3

; MMC/SD/SDHC initialization routine 
;1 
01256BFC: 000053032E01001ABC129FE50AB0A0E3 00005303FC00001ABC129FE50BB0A0E3 
01256C0C: 0220A0E3B4429FE50B0053E303F18F90 0220A0E3B4429FE50C0053E303F18F90 
01256C1C: 210100EA0A0000EA0D0000EA0F0000EA EF0000EA0B0000EA0E0000EA100000EA 
01256C2C: 100000EA160000EA1B0000EA340000EA 160000EA1F0000EA2A0000EA3A0000EA 
;2 
01256C3C: 3F0000EA630000EA770000EABD0000EA 540000EA5F0000EA790000EAB90000EA 
01256C4C: F00000EA4420C5E54570C5E52E3301EB CA0000EAEE0000EA4420C5E54570C5E5 
01256C5C: DB0000EA4520C5E59A3201EBE00000EA 2D3301EBD80000EA4520C5E5993201EB 
01256C6C: 0300A0E3000000EA0400A0E34500C5E5 020100EA0300A0E34500C5E504608DE5 
;3 
01256C7C: 04608DE50000A0E30120A0E304108DE2 0120A0E304108DE20000A0E3CD0000EA 
01256C8C: CE0000EA0500A0E34500C5E5BE73C5E1 0400A0E34500C5E5AA10A0E3011C81E2 
01256C9C: 04008DE2D0FEFFEB0A0000EA6000D5E5 04008DE2D0FEFFEB0120A0E304108DE2 
01256CAC: 3F0050E3C800001A6100D5E5800010E3 0800A0E3C30000EABE73C5E1B674C5E1 
;4 
01256CBC: 0800001A04008DE2C7FEFFEBBE03D5E1 6000D5E5080050E34770C5050500A0E3 
01256CCC: 010080E2BE03C5E10120A0E304108DE2 4500C5E504608DE50120A0E304108DE2 
01256CDC: 0100A0E3B90000EA0420A0E3611085E2 3700A0E3B70000EA6000D5E5370050E3 
01256CEC: 400085E2254F10EB0600A0E34500C5E5 B664C5110600A0E34500C5E54700D5E5 
;5 
01256CFC: 04608DE50200A0E30020A0E304108DE2 010050E30111810304008DE2B6FEFFEB 
01256D0C: AE0000EA140085E20E0194E80E0180E8 0120A0E304108DE24600D5E5010050E3 
01256D1C: 0700A0E34500C5E504008DE2401BA0E3 2900A0030100A013A60000EA6000D5E5 
01256D2C: ADFEFFEB0120A0E304108DE20300A0E3 3F0050E3CB00001A6100D5E5800010E3 
;6 
01256D3C: A20000EA000050E3A300001A0400A0E1 0600001ABE03D5E1010080E2BE03C5E1 
01256D4C: A0FEFFEB020050E31500000A0400A0E1 4600D5E5010050E3DBFFFF0AE6FFFFEA 
01256D5C: 9CFEFFEB0020A0E10A00A0E1581F8FE2 400010E34770C5154760C5050420A0E3 
01256D6C: 494B10FA2010A0E30A00A0E13562FFEB 611085E2400085E2044F10EB0700A0E3 
;7 
01256D7C: 030000EF0020A0E30810A0E11000A0E3 4500C5E504608DE50020A0E304108DE2 
01256D8C: 2363FFEB386085E54560C5E54470C5E5 0200A0E38B0000EA140085E20E0194E8 
01256D9C: 006085E5BC63C5E1100095E530FF2FE1 0E0180E80800A0E34500C5E5010CA0E3 
01256DAC: 8F0000EA0800A0E34500C5E504008DE2 B205C5E104008DE50120A0E304108DE2 
;8 
01256DBC: 401BA0E388FEFFEB0020A0E304108DE2 0300A0E37F0000EA000050E3A500001A 
01256DCC: 0900A0E37D0000EA000050E37E00001A 0400A0E17FFEFFEB020050E30500000A 
01256DDC: 240085E20E0194E80E0180E8F4FEFFEB 0400A0E17BFEFFEB0020A0E10A00A0E1 
01256DEC: 0900A0E34500C5E55C0095E5000050E3 DC108FE2910000EA4600D5E5010050E3 
;9 
01256DFC: 7500001AB005D5E19B0000E0DA3201EB 0300001A2228A0E15320C5E52224A0E1 
01256E0C: 401BA0E304008DE273FEFFEB0120A0E3 5220C5E50900A0E34500C5E5B215D5E1 
01256E1C: 04108DE20D00A0E3680000EA000050E3 04108DE50020A0E304108DE20900A0E3 
01256E2C: 6900001A0400A0E166FEFFEB030050E3 640000EA000050E38A00001A240085E2 
;10 
01256E3C: 3400000A0400A0E162FEFFEB0020A0E1 0E0194E80E0180E8DDFEFFEB0A00A0E3 
01256E4C: 0A00A0E19C108FE20F4B10FA2010A0E3 4500C5E55C0095E5000050E38100001A 
01256E5C: 0A00A0E1FB61FFEB030000EF0020A0E3 B005D5E19B0000E0C33201EBB215D5E1 
01256E6C: 0810A0E11000A0E3E962FFEB386085E5 04108DE50120A0E304108DE20D00A0E3 
;11 
01256E7C: 4560C5E54470C5E5006085E5BC63C5E1 500000EAFFFFFFFFFFFFFFFFFFFFFFFF 
01256E8C: 100095E530FF2FE1550000EA00BC6CA8 FFFFFFFFFFFFFFFFFFFFFFFF,0xA86CBC00 ;S65 RAM ADRES: 0xA86CBC00
01256E9C: 8CD930A170BC6CA84D4D4320496E6974 8CD930A1,0xA86CBC70,4D4D4320496E6974 ;S65 RAM ADRES: 0xA86CBC00+0x70
01256EAC: 20434D44312074727920636F756E7465 20434D44312074727920636F756E7465 
;12 
01256EBC: 72206F7665722072756E00000080FF00 72206F7665722072756E00000080FF00 
01256ECC: 60BC6CA84D4D432053746174653A2569 0xA86CBC60,4D4D432053746174653A2569 ;S65 RAM ADRES: 0xA86CBC00+0x60
01256EDC: 202065787065637420455F4964656E74 2065787065637420455F4964656E7453 
01256EEC: 53746174650000004D4D432053746174 74617465000000004D4D432053746174 
;13 
01256EFC: 653A25692065787065637420455F5374 653A25692065787065637420455F5374 
01256F0C: 62795374617465000400A0E12DFEFFEB 62795374617465004D4D432053746174 
01256F1C: 030050E30700001A45B0C5E5401BA0E3 653A25692065787065637420455F5472 
01256F2C: 04008DE22CFEFFEB0120A0E304108DE2 616E537461746500000050E34900001A 
;14 
01256F3C: 0700A0E3210000EA0400A0E121FEFFEB 0400A0E123FEFFEB030050E30000000A 
01256F4C: 030050E31500000A0400A0E11DFEFFEB 0E0000EA0400A0E11EFEFFEB030050E3 
01256F5C: 0020A0E10A00A0E178104FE2CA4A10FA 0600001A45B0C5E5B215D5E104108DE5 
01256F6C: 2010A0E30A00A0E1B661FFEB030000EF 0120A0E304108DE20700A0E3110000EA 
;15 
01256F7C: 0020A0E30810A0E11000A0E3A462FFEB 0400A0E113FEFFEB030050E30500000A 
01256F8C: 386085E54560C5E54470C5E5006085E5 0400A0E10FFEFFEB0020A0E10A00A0E1 
01256F9C: BC63C5E1100095E530FF2FE1100000EA B0104FE2250000EA0C00A0E34500C5E5 
01256FAC: 0B00A0E34500C5E504008DE2801FA0E3 04008DE2021CA0E30BFEFFEB0120A0E3 
;16 
01256FBC: 09FEFFEB0120A0E304108DE21000A0E3 04108DE21000A0E3A93201EB000050E3 
01256FCC: A73201EB000050E30500001A4560C5E5 2A00001A230000EA587085E5BE63C5E1 
01256FDC: 4470C5E5006085E5BC63C5E1100095E5 200000EA030000EF0020A0E30810A0E1 
01256FEC: 30FF2FE15C0095E5000050E34560C515 0B00A0E38A62FFEB1A0000EA020000EF 
;17 
01256FFC: 4470C51500608515BC63C51110009515 0020A0E30810A0E10500A0E31C62FFEB 
0125700C: 30FF2F11EFFEFFEA000050E3EEFFFF1A F0FEFFEA000050E31200001A0400A0E1 
0125701C: 0400A0E1EBFDFFEB040050E31500000A ECFDFFEB040050E3EAFFFF0A0400A0E1 
0125702C: 0400A0E1E7FDFFEB0020A0E10A00A0E1 E8FDFFEB0020A0E10A00A0E14B1F4FE2 
;18 
0125703C: 94108FE2944A10FA2010A0E30A00A0E1 954A10FA2010A0E30A00A0E18161FFEB 
0125704C: 8061FFEB030000EF0020A0E30810A0E1 030000EF0020A0E30810A0E11000A0E3 
0125705C: 1000A0E36E62FFEB386085E54560C5E5 6F62FFEB386085E54560C5E54470C5E5 
0125706C: 4470C5E5006085E5BC63C5E1100095E5 006085E5BC63C5E1100095E530FF2FE1 
;19 
0125707C: 30FF2FE1DAFFFFEA4560C5E54470C5E5 5C0095E5000050E34560C5154470C515 
0125708C: 006085E5BC63C5E1587085E5BE63C5E1 00608515BC63C5111000951530FF2F11 
0125709C: 100095E530FF2FE1D1FFFFEA030000EF CCFEFFEA4730D5E5000053E38004A001 
012570AC: 0020A0E30810A0E10B00A0E35862FFEB 1EFF2FE120021FE54700D0E5000050E3 
;20 
012570BC: C5FFFFEA020000EF0020A0E30810A0E1 8614A0010610A0111EFF2FE12C30D0E5 
012570CC: 0500A0E3EA61FFEBBEFEFFEA4D4D4320 2D20D0E5033482E0012BA0E3030000EA
012570DC: 53746174653A25692065787065637420 2220DDE5BC31DDE1022082E21122A0E1 
012570EC: 455F5472616E537461746500 013083E2930202E01EFF2FE1 

; MMC/SD/SDHC block read/write routine 

0125736C: 401BA0E31CFDFFEB B215D5E1001080E5 
01257484: 401BA0E304008DE2D5FCFFEB 04008DE2B215D5E1001080E5 
012576A4: 401BA0E304008DE24DFCFFEB 04008DE2B215D6E1001080E5 
012576CC: 04008DE2401BA0E343FCFFEB 04008DE2B215D6E1001080E5 
01257824: 401BA0E304008DE2EDFBFFEB 04008DE2B215D6E1001080E5 
01257850: 401BA0E304008DE2E2FBFFEB 04008DE2B215D6E1001080E5 
012A3290: 401BA0E314008DE20240A0E151CDFEEB 0240A0E1400E9FE5B215D0E114108DE5 
012A32D0: 401BA0E314008DE242CDFEEB 040E9FE5B215D0E114108DE5 
012A3348: 401BA0E314008DE224CDFEEB 8C0D9FE5B215D0E114108DE5 
012A352C: 401BA0E314008DE20240A0E1AACCFEEB 0240A0E1A40B9FE5B215D0E114108DE5 
012A356C: 401BA0E314008DE29BCCFEEB 680B9FE5B215D0E114108DE5 
012A35E4: 401BA0E314008DE27DCCFEEB F00A9FE5B215D0E114108DE5 
012A40CC: 436D64202578205374617475733A2578 436D642025782053746174653A257800 
012A40DC: 00000000 0xA86CBC00 ;S65 RAM ADRES: 0xA86CBC00

;012A40E0: D49676 58355B ;? разности в прошивках S65 и CX75 

;S65 RAM ADRES: 0xA86CBC00 00BC6CA8 

12570D4: 012B 4020
1236350: 920101E0 6E2BD7EB ; card free space calculation
09820A4: 4E31FFEB 28FCF9EB ; display card free space from My stuff tab
09820E0: 3F31FFEB 21FCF9EB ; display card size from My stuff tab
0982270: DB30FFEB BDFBF9EB ; display card free space from disk 4 tab
0982234: EA30FFEB C4FBF9EB ; display card size from disk 4 tab

#pragma enable old_equal_ff 
0801110: C1402DE90170A0E10700A0E10260A0E1
0801120: 960701E0BBD700EB060050E10200A013
0801130: 2772A0110620A0E1920701E004709FE5
0801140: 4700C715C180BDE800BC6CA800402DE9
0801150: 10E01FE547E0DEE502005EE328E09F15
0801160: 28E09F053EFF2FE10080BDE800402DE9
0801170: 30E01FE547E0DEE500005EE308E09F05
0801180: 08E09F153EFF2FE10080BDE8E4E594A0
0801190: 941180A0FE402DE90160B0E10250A0E1
08011A0: 0040A0E11400000A0600A0E1E3BE10FA
08011B0: 100050E31000003A0400A0E1B1C739EB
08011C0: 40508FE238109FE50400A0E1F03405EB
08011D0: ACC739EB81C739EB0010A0E104008DE2
08011E0: 4C3505EB0020A0E10510A0E10600A0E1
08011F0: 9DBC10FB0100A0E3FE80BDE80000A0E3
0801200: FCFFFFEAA0ACB9032573204742000000
#pragma disable old_equal_ff   

0801204: A0ACB903 00000004 ; Real size, Gb
 

;------------------------- end -------------------------

